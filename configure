#!/bin/bash

function show_help
{
	cat << EOF
Funky non-autotool config script for MLT.

	Options are:

	--help                  - this information
	--prefix=directory      - install prefix for path (default: $prefix)
EOF

	for i in src/modules/*
	do
		[ -d $i ] && [ "`basename $i`" != "CVS" ] && echo "	--disable-`basename $i`"
	done

	echo
}

function build_config
{
	echo VERSION=0.1.0
	echo prefix=$prefix
	echo bindir=$prefix/bin
}

# Debug mode
set +x

# Define build directory for scripts called
export build_dir=`dirname $0`
export prefix=/usr/local
export help=0

# Iterate through arguments
for i in $*
do
	case $i in
		--help )		help=1 ;;
		--prefix=* )	prefix="${i#--prefix=}" ;;
	esac
done

# Show help if requested
[ $help = 1 ] && show_help || build_config > config.mak

# Iterate through each of the components
for i in framework modules inigo valerie miracle humperdink
do
	if [ -x src/$i/configure ]
	then
		echo "Configuring `basename $i`:"
		pushd src/$i > /dev/null
		./configure $@
		[ $? != 0 ] && exit 1
		popd > /dev/null
	fi
done

