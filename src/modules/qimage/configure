#!/bin/sh

if [ "$help" = "1" ]
then
	cat << EOF
QImage options:

  --qimage-libdir         - Location of QT lib directory [/usr/lib/qt3]
  --qimage-includedir     - Location of QT include directory [/usr/include/qt3]
  --kde-libdir            - Location of KDE lib directory [/usr/lib]
  --kde-includedir        - Location of KDE include directory [/usr/include/kde]

EOF

else
	targetos=$(uname -s)
	case $targetos in
    MINGW32*)
        export LIBSUF=.dll
        ;;
	Darwin)
		export LIBSUF=.dylib
		;;
	Linux)
		export LIBSUF=.so
		;;
	*)
		;;
	esac

	qimage_includedir=/usr/include/qt3
	qimage_libdir=/usr/lib/qt3

	kde_includedir=/usr/include/kde
	kde_libdir=/usr/lib

	if [ "$QTDIR" != "" ]
	then
		qimage_includedir="$QTDIR/include"
		qimage_libdir="$QTDIR"
	fi

	if [ "$KDEDIR" != "" ]
	then
		kde_includedir="$KDEDIR/include"
		kde_libdir="$KDEDIR"
	fi

	for i in "$@"
	do
		case $i in
			--qimage-libdir=* )	qimage_libdir="${i#--qimage-libdir=}" ;;
			--qimage-includedir=* )	qimage_includedir="${i#--qimage-includedir=}" ;;
			--kde-libdir=* )	kde_libdir="${i#--kde-libdir=}" ;;
			--kde-includedir=* )	kde_includedir="${i#--kde-includedir=}" ;;
		esac
	done

	if [ -d "$qimage_libdir" -a -d "$qimage_includedir" ]
	then
		echo > config.h
		echo > config.mak
		if [ -d "$kde_includedir" ]
		then 
			echo "#define USE_KDE" >> config.h
			echo "USE_KDE=1" >> config.mak
			echo QTCXXFLAGS=-I$qimage_includedir -I$kde_includedir >> config.mak
			echo QTLIBS=-L$qimage_libdir/lib -L$kde_libdir/lib -lqt-mt >> config.mak
		else 
			echo "qimage: KDE environment not found - disabling extra image formats"
			echo QTCXXFLAGS=-I$qimage_includedir >> config.mak
			echo QTLIBS=-L$qimage_libdir/lib -lqt-mt >> config.mak
		fi
		echo qimage		libmltqimage$LIBSUF >> ../producers.dat
	else
		echo "qimage: QT environment not found - disabling"
		touch ../disable-qimage
	fi

fi
