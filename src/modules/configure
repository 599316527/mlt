#!/bin/bash

# Clean up disables if not in help mode
[ "$help" != "1" ] && rm -f disable-* producers.dat filters.dat transitions.dat consumers.dat

# Create the make.inc file
echo SUBDIRS = `find -type d -maxdepth 1 | grep -v CVS | grep -v "^.$" | sed 's/\.\///'` > make.inc

# Iterate through arguments
for i in "$@"
do
	case $i in
		--disable-* )	touch disable-${i#--disable-} ;;
	esac
done

# Iterate through each of the components
for i in *
do
	if [ -x $i/configure -a \( "$help" = "1" -o ! -f disable-$i \) ]
	then
		if [ "$gpl" = "true" -o ! -f $i/gpl ]
		then
			[ "$help" = "0" ] && echo "Configuring modules/$i:"
			pushd $i > /dev/null
			./configure "$@"
			[ $? != 0 ] && exit 1
			popd > /dev/null
		elif [ "$help" = "0" ]
		then
			touch disable-$i
		fi
	fi
done

