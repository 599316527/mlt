#!/bin/sh

path=`which mlt-config 2>/dev/null`
[ $? != 0 ] && echo "MLT not installed - aborting" && exit 1 

# Determine default prefix
prefix=`mlt-config --prefix`
[ "$prefix" = "" ] && echo "Can't locate MLT's prefix - please reconfigure MLT." && exit 1

# Allow override from command line
[ "$1" != "" ] && prefix="${1#--prefix=}"

# Sanity check
[ ! -d "$prefix" ] && echo "Invalid prefix $prefix - aborting" && exit 1

echo "prefix=$prefix" > config.mak

targetos=$(uname -s)

case $targetos in 
	Darwin)
		echo LIBSUF=.dylib
        echo "CXXFLAGS+=-D__DARWIN__ -Wall -fPIC `mlt-config --cflags`"
        echo "LDFLAGS=-dynamiclib `mlt-config --libs` `mlt-config miracle --libs` `mlt-config valerie --libs` -single_module"
		;;
	Linux)
		echo LIBSUF=.so
        echo "CXXFLAGS+=-pthread -Wall -fPIC `mlt-config --cflags`"
        echo "LDFLAGS=-shared `mlt-config --libs` `mlt-config miracle --libs`"
		;;
esac >> config.mak

echo "MLT++ configured - will be installed in $prefix."

